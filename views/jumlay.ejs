<!DOCTYPE html>
<html lang="ur" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <title>Urdu Jumlay Practice</title>
    <link rel="stylesheet" href="/styles/shared.css" />
    <link rel="stylesheet" href="/styles/navbtn.css">
  <style>
    :root {
      --primary-color: #008080;
      --secondary-color: #e9f5f5;
      --text-color: #3b3b3b;
      --highlight-bg: #fff9c4;
    }

    body {
      font-family: 'Noto Nastaliq Urdu', 'Arial', sans-serif;
      background-color: var(--secondary-color);
      color: var(--text-color);
      padding: 20px;
      margin: 0;
      direction: rtl;
    }

    h2 {
      text-align: center;
      color: var(--text-color);
      font-size: 28px;
      margin-bottom: 20px;
    }

    .main-card {
      max-width: 800px;
      margin: 20px auto;
      background: #ffffff;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .cards {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .card {
      background-color: #d7f0f0;
      border: 1px solid var(--primary-color);
      padding: 15px 20px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
      position: relative;
      font-size: 18px;
      color: var(--text-color);
    }

    .card:hover {
      background-color: #c1ecec;
    }

    .practice-btn {
      margin-top: 10px;
      background-color: var(--primary-color);
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s ease;
    }

    .practice-btn:hover:not(:disabled) {
      background-color: #006666;
    }

    .practice-btn:disabled {
      background: #999;
      cursor: not-allowed;
    }

    #report {
      max-width: 800px;
      margin: 20px auto;
      background-color: var(--highlight-bg);
      padding: 18px;
      border-radius: 10px;
      color: var(--text-color);
      font-size: 18px;
      line-height: 1.6;
    }

    /* âœ… Responsive tweaks */
    @media (max-width: 768px) {

      .main-card,
      #report {
        padding: 16px;
      }

      .cards {
        grid-template-columns: 1fr 1fr;
      }

      .card {
        font-size: 16px;
        padding: 12px;
      }

      .practice-btn {
        font-size: 14px;
        padding: 6px 12px;
      }
    }

    @media (max-width: 480px) {
      .cards {
        grid-template-columns: 1fr;
      }

      .card {
        font-size: 15px;
        padding: 10px;
      }

      .practice-btn {
        font-size: 14px;
        width: 100%;
      }
    }
  </style>
</head>

<body>
 <%- include('partials/header') %>
  <%- include('partials/navbtn') %>

  <h2>Ø¢Ø³Ø§Ù† Ø¬Ù…Ù„Û’</h2>
  <div class="main-card" id="Easy">
    <section class="cards">
      <div class="card" data-audio="audio/Jumly/easy/ap kysy hyn.wav" data-text="Ø¢Ù¾ Ú©ÛŒØ³Û’ ÛÛŒÚºØŸ">
        Ø¢Ù¾ Ú©ÛŒØ³Û’ ÛÛŒÚºØŸ
        <button class="practice-btn">Practice</button>
      </div>
      <div class="card" data-audio="audio/Jumly/easy/hum dost hain.wav" data-text="ÛÙ… Ø¯ÙˆØ³Øª ÛÛŒÚºÛ”">
        ÛÙ… Ø¯ÙˆØ³Øª ÛÛŒÚºÛ”
        <button class="practice-btn">Practice</button>
      </div>
      <div class="card" data-audio="audio/Jumly/easy/khana tyar hai.wav" data-text="Ú©Ú¾Ø§Ù†Ø§ ØªÛŒØ§Ø± ÛÛ’Û”">
        Ú©Ú¾Ø§Ù†Ø§ ØªÛŒØ§Ø± ÛÛ’Û”
        <button class="practice-btn">Practice</button>
      </div>
      <div class="card" data-audio="\audio\Jumly\high\achy khyalat insan ky kirdar ko bulandi ata krty hyn .wav"> Ø§Ú†Ú¾Û’
        Ø®ÛŒØ§Ù„Ø§Øª Ø§Ù†Ø³Ø§Ù† Ú©Û’ Ú©Ø±Ø¯Ø§Ø± Ú©Ùˆ Ø¨Ù„Ù†Ø¯ÛŒ Ø¹Ø·Ø§ Ú©Ø±ØªÛ’ ÛÛŒÚºÛ”
        <button class="practice-btn">Practice</button>

      </div>

      <div class="card"
        data-audio="\audio\Jumly\high\aman aur skoon ky bgair khushhal Zindagi ka taswur namumkin h .wav"> Ø§Ù…Ù† Ø§ÙˆØ± Ø³Ú©ÙˆÙ†
        Ú©Û’ Ø¨ØºÛŒØ± Ø®ÙˆØ´Ø­Ø§Ù„ Ø²Ù†Ø¯Ú¯ÛŒ Ú©Ø§ ØªØµÙˆØ± Ù†Ø§Ù…Ù…Ú©Ù† ÛÛ’Û”
        <button class="practice-btn">Practice</button>

      </div>
      <div class="card"
        data-audio="\audio\Jumly\high\khuwabon ki taabeer whi log paaty hyn Jo jagty huai mehnt krty hyn. .wav"> Ø®ÙˆØ§Ø¨ÙˆÚº
        Ú©ÛŒ ØªØ¹Ø¨ÛŒØ± ÙˆÛÛŒ Ù„ÙˆÚ¯ Ù¾Ø§ØªÛ’ ÛÛŒÚº Ø¬Ùˆ Ø¬Ø§Ú¯ØªÛ’ ÛÙˆØ¦Û’ Ù…Ø­Ù†Øª Ú©Ø±ØªÛ’ ÛÛŒÚºÛ”
        <button class="practice-btn">Practice</button>

      </div>
      <div class="card" data-audio="\audio\Jumly\high\kirdar ki pakeezgi insan ko bulandiyon tk pohncha skti h. .wav">
        Ú©Ø±Ø¯Ø§Ø± Ú©ÛŒ Ù¾Ø§Ú©ÛŒØ²Ú¯ÛŒ Ø§Ù†Ø³Ø§Ù† Ú©Ùˆ Ø¨Ù„Ù†Ø¯ÛŒÙˆÚº ØªÚ© Ù¾ÛÙ†Ú†Ø§ Ø³Ú©ØªÛŒ ÛÛ’Û”
        <button class="practice-btn">Practice</button>

      </div>
      <div class="card" data-audio="\audio\Jumly\high\muhabbt wo dolat h Jo tkseem krny sy bhrti h.wav"> Ù…Ø­Ø¨Øª ÙˆÛ Ø¯ÙˆÙ„Øª ÛÛ’
        Ø¬Ùˆ ØªÙ‚Ø³ÛŒÙ… Ú©Ø±Ù†Û’ Ø³Û’ Ø¨Ú‘Ú¾ØªÛŒ ÛÛ’Û”
        <button class="practice-btn">Practice</button>

      </div>
      <div class="card" data-audio="\audio\Jumly\high\sbr aur istqamt hr toofan ka mukabla krny ka hunr dyti hyn .wav">
        ØµØ¨Ø± Ø§ÙˆØ± Ø§Ø³ØªÙ‚Ø§Ù…Øª ÛØ± Ø·ÙˆÙØ§Ù† Ú©Ø§ Ù…Ù‚Ø§Ø¨Ù„Û Ú©Ø±Ù†Û’ Ú©Ø§ ÛÙ†Ø± Ø¯ÛŒØªÛŒ ÛÛŒÚºÛ”
        <button class="practice-btn">Practice</button>

      </div>
      <div class="card" data-audio="\audio\Jumly\high\schai ki takt insan ko hr mushkil sy Nikal skti h. .wav"> Ø³Ú†Ø§Ø¦ÛŒ Ú©ÛŒ
        Ø·Ø§Ù‚Øª Ø§Ù†Ø³Ø§Ù† Ú©Ùˆ ÛØ± Ù…Ø´Ú©Ù„ Ø³Û’ Ù†Ú©Ø§Ù„ Ø³Ú©ØªÛŒ ÛÛ’Û”
        <button class="practice-btn">Practice</button>

      </div>
      <div class="card" data-audio="\audio\Jumly\high\wqt ka zya Zindagi ky qeemti lmhat ko bemksd krdyta h .wav"> Û” ÙˆÙ‚Øª
        Ú©Ø§ Ø¶ÛŒØ§Ø¹ Ø²Ù†Ø¯Ú¯ÛŒ Ú©Û’ Ù‚ÛŒÙ…ØªÛŒ Ù„Ù…Ø­Ø§Øª Ú©Ùˆ Ø¨Û’ Ù…Ù‚ØµØ¯ Ú©Ø± Ø¯ÛŒØªØ§ ÛÛ’
        <button class="practice-btn">Practice</button>

      </div>
      <div class="card" data-audio="\audio\Jumly\high\zhant srf ilm main nhi, blky aml myn bhi jhltki h.wav"> Ø°ÛØ§Ù†Øª ØµØ±Ù
        Ø¹Ù„Ù… Ù…ÛŒÚº Ù†ÛÛŒÚºØŒ Ø¨Ù„Ú©Û Ø¹Ù…Ù„ Ù…ÛŒÚº Ø¨Ú¾ÛŒ Ø¬Ú¾Ù„Ú©ØªÛŒ ÛÛ’Û”
        <button class="practice-btn">Practice</button>

      </div>
      <div class="card"
        data-audio="\audio\Jumly\high\Zindagi ky sfr myn hr nakami aik nai kamyabi ka pysh-e- khyma bn skti h. .wav">
        Ø²Ù†Ø¯Ú¯ÛŒ Ú©Û’ Ø³ÙØ± Ù…ÛŒÚº ÛØ± Ù†Ø§Ú©Ø§Ù…ÛŒ Ø§ÛŒÚ© Ù†Ø¦ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ú©Ø§ Ù¾ÛŒØ´ Ø®ÛŒÙ…Û Ø¨Ù† Ø³Ú©ØªÛŒ ÛÛ’Û”
        <button class="practice-btn">Practice</button>

      </div>
    </section>
  </div>

  <div id="report"></div>

  <script>
    // Play audio when sentence clicked (excluding practice button)
    document.querySelectorAll(".card").forEach(card => {
      card.addEventListener("click", e => {
        if (e.target.classList.contains("practice-btn")) return; // ignore practice button click

        const audioSrc = card.getAttribute("data-audio");
        if (audioSrc) {
          const audio = new Audio(audioSrc.replace(/\\/g, "/"));
          audio.play();
        }
      });
    });

    // Speech Recognition Setup
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
      alert("Ø¢Ù¾ Ú©Û’ Ø¨Ø±Ø§Ø¤Ø²Ø± Ù…ÛŒÚº Speech Recognition Ø³Ù¾ÙˆØ±Ù¹ Ù†ÛÛŒÚº ÛÛ’Û”");
    }

    const recognition = new SpeechRecognition();
    recognition.lang = 'ur-PK'; // Urdu Pakistan locale
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    const reportDiv = document.getElementById("report");

    function compareTexts(target, spoken) {
      // Normalize (remove spaces & punctuation for simple letter comparison)
      const normalize = text => text.replace(/[Û”ØŒ?!ØŒØŒØŸ\s]/g, '').toLowerCase();

      let normTarget = normalize(target);
      let normSpoken = normalize(spoken);

      let report = "";
      if (normTarget === normSpoken) {
        report = "Ø²Ø¨Ø±Ø¯Ø³Øª! Ø¢Ù¾ Ù†Û’ Ø¬Ù…Ù„Û Ø¨Ø§Ù„Ú©Ù„ ØµØ­ÛŒØ­ Ø¨ÙˆÙ„Ø§Û” ğŸ‰";
      } else {
        // Identify letters that don't match
        let differences = [];
        let maxLen = Math.max(normTarget.length, normSpoken.length);
        for (let i = 0; i < maxLen; i++) {
          if (normTarget[i] !== normSpoken[i]) {
            differences.push(normTarget[i] || '[Ø®ØªÙ…]');
          }
        }
        report = `Ø¢Ù¾ Ù†Û’ Ú©Ú†Ú¾ Ø§Ù„ÙØ§Ø¸ ØºÙ„Ø· Ø¨ÙˆÙ„Û’ ÛÛŒÚºÛ” Ù…Ù…Ú©Ù†Û ØºÙ„Ø·ÛŒ ÙˆØ§Ù„Û’ Ø­Ø±Ù/Ø§Ù„ÙØ§Ø¸: <strong>${differences.join(', ')}</strong><br>Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø§Ù† Ù¾Ø± ØªÙˆØ¬Û Ø¯ÛŒÚº Ø§ÙˆØ± Ø¯ÙˆØ¨Ø§Ø±Û Ú©ÙˆØ´Ø´ Ú©Ø±ÛŒÚºÛ”`;
      }
      return report;
    }

    // Handle practice button click
    document.querySelectorAll(".practice-btn").forEach(btn => {
      btn.addEventListener("click", async (e) => {
        e.stopPropagation(); // Prevent parent card audio play
        const card = e.target.closest(".card");
        const targetText = card.getAttribute("data-text");

        btn.disabled = true;
        btn.textContent = "Ø³Ù† Ø±ÛØ§ ÛÙˆÚº... Ø¨ÙˆÙ„ÛŒÚº";

        recognition.start();

        recognition.onresult = (event) => {
          const spokenText = event.results[0][0].transcript;
          console.log("User said:", spokenText);
          const feedback = compareTexts(targetText, spokenText);
          reportDiv.innerHTML = `<h3>Ø¢Ù¾ Ù†Û’ Ú©ÛØ§: "${spokenText}"</h3><p>${feedback}</p>`;
          btn.disabled = false;
          btn.textContent = "Practice";
        };

        recognition.onerror = (event) => {
          reportDiv.textContent = "Ù…Ø¹Ø°Ø±ØªØŒ Ø¢ÙˆØ§Ø² Ú©ÛŒ Ø´Ù†Ø§Ø®Øª Ù†ÛÛŒÚº ÛÙˆ Ø³Ú©ÛŒÛ” Ø¯ÙˆØ¨Ø§Ø±Û Ú©ÙˆØ´Ø´ Ú©Ø±ÛŒÚºÛ”";
          btn.disabled = false;
          btn.textContent = "Practice";
        };

        recognition.onend = () => {
          if (btn.disabled) { // If user stopped speaking without result
            btn.disabled = false;
            btn.textContent = "Practice";
          }
        };
      });
    });
  </script>
  <%- include('partials/footer') %>
</body>

</html>